<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>ä¸çˆªæºè€ Â· Hand in Paw</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f6f7f8;
      color: #333;
    }
    header {
      background: #f2c94c;
      padding: 20px;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 22px;
    }
    header p {
      margin: 4px 0 0;
      font-size: 14px;
    }
    section {
      background: #fff;
      margin: 16px;
      padding: 16px;
      border-radius: 12px;
    }
    h2 {
      font-size: 18px;
      margin-top: 0;
    }
    input, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background: #f2c94c;
      border: none;
      font-weight: bold;
    }
    .source {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
      line-height: 1.4;
    }
    .hint {
      color: #999;
      font-size: 14px;
      line-height: 1.5;
    }
    .date-nav {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .date-nav button {
      width: 48%;
    }
  </style>
</head>

<body>

<header>
  <h1>ä¸çˆªæºè€ Â· Hand in Paw</h1>
  <p>Senior Dog Companion Calendar</p>
</header>

<!-- å¹´é¾„æ¢ç®—å™¨ -->
<section>
  <h2>ğŸ¾ å¹´é¾„æ¢ç®—å™¨</h2>
  <input type="number" id="dogAge" placeholder="è¾“å…¥ç‹—ç‹—å¹´é¾„ï¼ˆå¹´ï¼‰" step="0.1">
  <button onclick="calcAge()">è®¡ç®—å¯¹åº”äººç±»å¹´é¾„</button>
  <div id="ageResult"></div>
  <div class="source">
    å…¬å¼ï¼š16 Ã— ln(ç‹—çš„å¹´é¾„) + 31  
    <br>Cell Systems, 2020ï¼ˆç ”ç©¶å¯¹è±¡ï¼šæ‹‰å¸ƒæ‹‰å¤šçŠ¬ï¼‰
  </div>
</section>

<!-- ä»Šæ—¥å†…å®¹ -->
<section>
  <h2 id="dateTitle">ğŸ“˜ ä»Šæ—¥é™ªä¼´</h2>
  <div id="content"></div>
  <div id="hint" class="hint"></div>
  <div class="source" id="source"></div>

  <div class="date-nav">
    <button onclick="changeDay(-1)">æŸ¥çœ‹å‰ä¸€å¤©</button>
    <button onclick="changeDay(1)">æŸ¥çœ‹åä¸€å¤©</button>
  </div>
</section>

<!-- æˆ‘çš„æé†’ -->
<section>
  <h2>ğŸ—“ æˆ‘çš„è®°å½•</h2>
  <textarea id="note" rows="4" placeholder="ä¾‹å¦‚ï¼šä¸‹å‘¨äºŒå…½åŒ»å¤æŸ¥"></textarea>
  <button onclick="saveNote()">ä¿å­˜</button>
</section>

<script>
let currentDate = new Date();

function formatKey(date) {
  return String(date.getMonth() + 1).padStart(2, "0") + "-" +
         String(date.getDate()).padStart(2, "0");
}

function showDay(date) {
  const today = new Date();
  const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
  const targetStart = new Date(date.getFullYear(), date.getMonth(), date.getDate());

  document.getElementById("dateTitle").innerText =
    `ğŸ“˜ ${date.getMonth()+1} æœˆ ${date.getDate()} æ—¥`;

  fetch("data.json")
    .then(res => res.json())
    .then(data => {
      const key = formatKey(date);

      if (targetStart <= todayStart && data[key]) {
        document.getElementById("content").innerHTML =
          `<strong>${data[key].title}</strong><p>${data[key].content}</p>`;
        document.getElementById("source").innerText = data[key].source;
        document.getElementById("hint").innerText = "";
      } else if (targetStart > todayStart) {
        document.getElementById("content").innerHTML = "";
        document.getElementById("source").innerText = "";
        document.getElementById("hint").innerText =
          "ğŸ¾ è¿™ä¸€å¤©è¿˜æ²¡åˆ°ï¼Œä¸çˆªæºè€ä¼šåœ¨é‚£ä¸€å¤©é™ªä½ ä¸€èµ·æ‰“å¼€ã€‚";
      } else {
        document.getElementById("content").innerHTML =
          "è¿™ä¸€å¤©æš‚æ—¶æ²¡æœ‰å†…å®¹ã€‚";
        document.getElementById("source").innerText = "";
        document.getElementById("hint").innerText = "";
      }
    });
}

function changeDay(delta) {
  currentDate.setDate(currentDate.getDate() + delta);
  showDay(currentDate);
}

function calcAge() {
  const age = parseFloat(document.getElementById("dogAge").value);
  if (!age || age <= 0) {
    document.getElementById("ageResult").innerText = "è¯·è¾“å…¥æœ‰æ•ˆå¹´é¾„";
    return;
  }
  const human = Math.round(16 * Math.log(age) + 31);
  document.getElementById("ageResult").innerText =
    `å¤§è‡´ç›¸å½“äºäººç±» ${human} å²`;
}

function saveNote() {
  localStorage.setItem("handInPawNote", document.getElementById("note").value);
  alert("å·²ä¿å­˜åœ¨æœ¬è®¾å¤‡");
}

window.onload = () => {
  showDay(currentDate);
  const saved = localStorage.getItem("handInPawNote");
  if (saved) document.getElementById("note").value = saved;
};
</script>

</body>
</html>
